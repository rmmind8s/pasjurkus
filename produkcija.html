<!DOCTYPE html>
<html lang="lt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Jautienos u≈æsakymas | Pas Jurkus prie J≈´ros üèû</title>

  <style>
    body { font-family: Arial, sans-serif; background:#fffef9; margin:0; }
    header { text-align:center; padding:20px; }
    h3 { margin-top:30px; border-bottom:2px solid #fcb016; padding-bottom:5px; }
    .product {
      display:flex; justify-content:space-between;
      padding:10px 0; border-bottom:1px solid #ddd;
    }
    select { width:60px; }
    footer {
      position:fixed; bottom:0; width:100%; background:#3f2c07; color:#fcb016;
      text-align:center; padding:10px 0;
    }
    .loader {
      width:32px; height:32px; border:4px solid rgba(0,0,0,0.15);
      border-top-color:#000; border-radius:50%; animation:spin 1s linear infinite;
      margin:40px auto;
    }
    @keyframes spin { to { transform:rotate(360deg); } }
  </style>
</head>

<body>

<header>
  <h1>Jurk≈≥ ≈†eimos ≈™kis</h1>
  <h2>Jautienos u≈æsakymas</h2>
</header>

<main style="max-width:600px; margin:0 auto; padding-bottom:120px;">
  <div id="products">
    <div class="loader" id="loader"></div>
  </div>
</main>

<footer>
  <button id="whatsappOrder" style="background:none; border:none; color:#fcb016; font-size:18px;">
    U≈æsakyti per WhatsApp
  </button>
</footer>

<script>
document.addEventListener('DOMContentLoaded', async () => {
  const container = document.getElementById('products');
  const loader = document.getElementById('loader');

  let products = [];

  try {
    const response = await fetch(
      'https://script.google.com/macros/s/AKfycbwWDqiaUB1EeIBQ0wdvbLo0HpGDgPefcnMu5ehukmY3zFwQfmdfyW6dv1y5_kXb774Q3A/exec'
    );

    products = await response.json();
  } catch (e) {
    loader.innerHTML = "Nepavyko u≈ækrauti duomen≈≥.";
    return;
  }

  // Sekcijos
  const beefSection = document.createElement('div');
  const dairySection = document.createElement('div');

  beefSection.innerHTML = `<h3>Jautienos gaminiai</h3>`;
  dairySection.innerHTML = `<h3>Pieno produktai</h3>`;

  // Atvaizdavimas
  products.forEach(p => {
    const balance = Math.max(0, Number(p.Balance) || 0);

    const row = document.createElement('div');
    row.className = 'product';
    row.innerHTML = `
      <div>
        <div>${p.Name}</div>
        <small>${p.Description || ''}</small>
      </div>
      <select id="sku-${p.SKU}">
        ${Array.from({ length: balance + 1 }, (_, i) =>
          `<option value="${i}">${i}</option>`
        ).join('')}
      </select>
    `;

    if (p.SKU.startsWith('J')) beefSection.appendChild(row);
    if (p.SKU.startsWith('P')) dairySection.appendChild(row);
  });

  loader.remove();
  container.appendChild(beefSection);
  container.appendChild(dairySection);

  // WhatsApp ≈æinutƒó
  document.getElementById('whatsappOrder').addEventListener('click', () => {
    const selected = products
      .map(p => {
        const el = document.getElementById(`sku-${p.SKU}`);
        const v = el ? Number(el.value) : 0;
        return v > 0 ? { sku: p.SKU, text: `${p.Name}: ${v}` } : null;
      })
      .filter(Boolean);

    if (!selected.length) {
      alert('Pasirinkite bent vienƒÖ produktƒÖ.');
      return;
    }

    const beef = selected.filter(i => i.sku.startsWith('J')).map(i => i.text).join('\n');
    const dairy = selected.filter(i => i.sku.startsWith('P')).map(i => i.text).join('\n');

    let msg = `U≈æsakymas ${generateOrderId()}\n`;

    if (beef) msg += `Jautienos gaminiai:\n${beef}\n`;
    msg += `***\n`;
    if (dairy) msg += `Pieno produktai:\n${dairy}\n`;
    msg += `***`;

    window.location.href =
      'https://wa.me/37062804118?text=' + encodeURIComponent(msg);
  });
});

function generateOrderId() {
  const d = new Date();
  return (
    '#' +
    (d.getFullYear() % 100).toString(36).toUpperCase() +
    (d.getMonth() + 1).toString(36).toUpperCase() +
    d.getDate().toString(36).toUpperCase() +
    d.getHours().toString().padStart(2, '0') +
    d.getMinutes().toString().padStart(2, '0')
  );
}
</script>

</body>
</html>
