<!DOCTYPE html>
<html lang="lt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Šviežios ūkio produkcijos užsakymas – jautiena ir pieno produktai</title>
<link href="https://fonts.googleapis.com/css2?family=Tagesschrift&display=swap" rel="stylesheet">
<script src="https://kit.fontawesome.com/11da5eb453.js" crossorigin="anonymous"></script>

<style>
:root {
  --dark: #3f2c07;
  --deep: #fcb016;
  --light: #ffe8a6;
  --lighter: #fffef9;
  --muted: #666;
}

*, *::before, *::after { box-sizing: border-box; }

body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  margin: 0; padding: 0;
  background: var(--lighter);
  color: var(--dark);
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  min-height: 100dvh;
  overflow-x: hidden;
  -webkit-text-size-adjust: 100%;
}

header {
  text-align: center;
  padding: 1.5rem 1rem 0.5rem;
}

header img { width: 240px; max-width: 100%; }

h1 { font-family: "Tagesschrift", system-ui; margin: 0.2rem 0; }
h3 { text-align: center; margin-bottom: 0.5rem; font-size: 1.2rem; padding-bottom: 0.3rem; font-family: "Tagesschrift", system-ui; }
main { flex: 1; padding: 0rem 1rem 5rem; width: 100%; max-width: 600px; margin: 0 auto; }

.product {
  display: flex;
  align-items: stretch;
  gap: 1rem;
  padding: 0.75rem 0;
  border-bottom: 1px solid #e5e5e5;
}

.product-info {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  width: 50%;
}

.product-info small { color: var(--muted); }
.product-name { font-weight: 600; }
.product-desc,
.product-use { display: block; color: var(--muted); line-height: 1.3; }
.product-use { font-style: italic; }

.product-price-qty {
  width: 50%;
  display: flex;
  flex-direction: column;
  align-items: flex-end;
}

.product-price { margin-top: 0; color: var(--dark); margin-right: 0.25rem; margin-bottom: 0.2rem; }

/* Modernus qty-container */
.qty-container {
  display: flex;
  align-items: center;
  border: 1px solid #ddd;
  border-radius: 12px;
  overflow: hidden;
  width: fit-content;
  background-color: #fff;
  box-shadow: 0 2px 5px rgba(0,0,0,0.08);
}

.qty-container button {
  width: 36px;
  height: 36px;
  border: none;
  background-color: #f8f8f8;
  font-size: 20px;
  cursor: pointer;
  transition: background 0.2s;
}

.qty-container button:hover { background-color: #f0f0f0; }
.qty-container button:active { background-color: #e0e0e0; }

.qty-container input[type="number"] {
  width: 50px;
  text-align: center;
  border: none;
  font-size: 18px;
  outline: none;
  -moz-appearance: textfield;
}

.qty-container input::-webkit-outer-spin-button,
.qty-container input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

footer {
  background: none;
  text-align: center;
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
}

footer button {
  color: var(--lighter);
  background-color: var(--dark);
  border: none;
  cursor: pointer;
  padding: 0.75rem 1rem;
  margin-bottom: 1rem;
  font-size: large;
  font-weight: 600;
  border-radius: 6px;
}

footer button:active { color: var(--dark); background-color: var(--deep); }

@media (hover: hover) {
  footer button:hover { color: var(--dark); background-color: var(--deep); }
}

.loader {
  width: 32px; height: 32px;
  border: 4px solid rgba(0,0,0,0.15);
  border-top-color: #000;
  border-radius: 50%;
  animation: spin 0.9s linear infinite;
  margin: 2rem auto;
}

@keyframes spin { to { transform: rotate(360deg); } }

.subtitle { font-size: large; }
</style>
</head>

<body>
<header>
  <a href="https://pasjurkus.lt/">
    <img src="https://pasjurkus.lt/img/logo-brown.png" alt="Jurkų Šeimos Ūkis">
  </a>
  <h1>Jurkų Šeimos Ūkis</h1>
  <p class="subtitle">Ūkio produkcijos užsakymas</p>
</header>

<main>
  <div id="products">
    <div class="loader" id="loader"></div>
  </div>
</main>

<footer>
  <button id="btnOrder">
    Užsakyti <i class="fa-brands fa-whatsapp"></i>
  </button>
</footer>

<script>
function checkSection(section) {
  if (!section.querySelector('.product')) {
    section.innerHTML += `<p style="color: var(--muted); font-style: italic;">Šiuo metu neturime.</p>`;
  }
}

document.addEventListener('DOMContentLoaded', async () => {
  const container = document.getElementById('products');
  const loader = document.getElementById('loader');

  let products = [];

  try {
    const response = await fetch(`produkcija.json?v=${new Date().getTime()}`);
    if (!response.ok) throw new Error("Failas nerastas");
    products = await response.json();
  } catch (e) {
    loader.textContent = "Nepavyko užkrauti duomenų iš failo.";
    console.error(e);
    return;
  }

  const beefSection = document.createElement('div');
  const cheeseSection = document.createElement('div');
  const otherSection = document.createElement('div');

  beefSection.innerHTML = `<h3>Šviežia jautiena</h3>`;
  cheeseSection.innerHTML = `<h3>Sūriai</h3>`;
  otherSection.innerHTML = `<h3>Kiti produktai</h3>`;

  products.forEach(p => {
    const balance = Math.max(0, Number(p.Balance) || 0);

    const row = document.createElement('div');
    row.className = 'product';

    row.innerHTML = `
      <div class="product-info">
        <div class="product-name">${p.Name}</div>
        <small class="product-balance">Likutis: <strong>${balance}</strong></small>
        ${p.Description ? `<small class="product-desc">${p.Description}</small>` : ''}
        ${p.Use ? `<small class="product-use">${p.Use}</small>` : ''}
      </div>

      <div class="product-price-qty">
        ${p.Price ? `<span class="product-price">${p.Price} EUR/${p.Unit}</span>` : ''}
        <div class="qty-container" data-sku="${p.SKU}">
          <button type="button" class="decrease">-</button>
          <input type="number" min="0" max="${balance}" value="0" />
          <button type="button" class="increase">+</button>
        </div>
      </div>
    `;

    if (p.SKU.startsWith('J')) beefSection.appendChild(row);
    else if (p.SKU.startsWith('S')) cheeseSection.appendChild(row);
    else if (p.SKU.startsWith('O')) otherSection.appendChild(row);
  });

  loader.remove();
  container.appendChild(beefSection);
  container.appendChild(cheeseSection);
  container.appendChild(otherSection);

  checkSection(beefSection);
  checkSection(cheeseSection);
  checkSection(otherSection);

  document.querySelectorAll('.qty-container').forEach(container => {
    const input = container.querySelector('input');
    const max = Number(input.max);

    container.querySelector('.increase').addEventListener('click', () => {
      let val = Number(input.value);
      if (val < max) input.value = val + 1;
    });

    container.querySelector('.decrease').addEventListener('click', () => {
      let val = Number(input.value);
      if (val > 0) input.value = val - 1;
    });
  });

  document.getElementById('btnOrder').addEventListener('click', () => {
    const selected = products.map(p => {
      const container = document.querySelector(`.qty-container[data-sku="${p.SKU}"]`);
      const input = container ? container.querySelector('input') : null;
      const v = input ? Number(input.value) : 0;
      return v > 0 ? { sku: p.SKU, text: `${p.Name}: ${v}` } : null;
    }).filter(Boolean);

    if (!selected.length) {
      alert('Pasirinkite bent vieną produktą.');
      return;
    }

    const beef = selected.filter(i => i.sku.startsWith('J')).map(i => `* ${i.text}`).join('\n');
    const cheese = selected.filter(i => i.sku.startsWith('S')).map(i => `* ${i.text}`).join('\n');
    const other = selected.filter(i => i.sku.startsWith('O')).map(i => `* ${i.text}`).join('\n');

    let msg = `Užsakymas ${generateOrderId()}\n`;
    if (beef) msg += `*Jautiena*\n${beef}\n`;
    if (cheese) msg += `*Sūriai*\n${cheese}\n`;
    if (other) msg += `*Kiti produktai*\n${other}\n`;
    msg += `Suprantu, kad užsakomus kiekius dar turės patvirtinti ūkis.`;

    window.location.href = 'https://wa.me/37062804118?text=' + encodeURIComponent(msg);
  });
});

function generateOrderId() {
  const d = new Date();
  return (
    '#' +
    (d.getFullYear() % 100).toString(36).toUpperCase() +
    (d.getMonth() + 1).toString(36).toUpperCase() +
    d.getDate().toString(36).toUpperCase() +
    d.getHours().toString().padStart(2, '0') +
    d.getMinutes().toString().padStart(2, '0')
  );
}
</script>
</body>
</html>
